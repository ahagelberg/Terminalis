<TabItem x:Class="TabbySSH.Views.TerminalTabItem"
         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
         xmlns:views="clr-namespace:TabbySSH.Views"
         xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
         xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
         mc:Ignorable="d"
         ContextMenuOpening="TerminalTabItem_ContextMenuOpening">
    <TabItem.Style>
        <Style TargetType="TabItem">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border x:Name="Border" 
                                Background="{DynamicResource TabBackground}"
                                BorderBrush="Transparent"
                                BorderThickness="1,1,1,0"
                                Margin="0,0,2,0"
                                CornerRadius="4,4,0,0"
                                Padding="0">
                            <Grid>
                                <Border x:Name="AccentOverlay" Background="{TemplateBinding Background}" Opacity="0.25" CornerRadius="4,4,0,0"/>
                                <ContentPresenter x:Name="ContentSite"
                                                  VerticalAlignment="Center"
                                                  HorizontalAlignment="Stretch"
                                                  ContentSource="Header"
                                                  Margin="12,2,2,2"
                                                  RecognizesAccessKey="True"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Panel.ZIndex" Value="100"/>
                                <Setter TargetName="Border" Property="Background" Value="{DynamicResource TabSelectedBackground}"/>
                                <Setter TargetName="Border" Property="BorderBrush" Value="{DynamicResource TabForeground}"/>
                                <Setter TargetName="Border" Property="BorderThickness" Value="1,1,1,0"/>
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsMouseOver" Value="True"/>
                                    <Condition Property="IsSelected" Value="False"/>
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Border" Property="BorderBrush" Value="{DynamicResource TabHoverBorder}"/>
                                <Setter TargetName="Border" Property="BorderThickness" Value="1,1,1,0"/>
                            </MultiTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </TabItem.Style>
    <TabItem.Header>
        <Grid ContextMenuOpening="Header_ContextMenuOpening">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <StackPanel x:Name="HeaderPanel" Orientation="Horizontal" Grid.Column="0">
                <Ellipse x:Name="StatusIndicator" Width="8" Height="8" Margin="0,0,5,0" 
                         VerticalAlignment="Center" Fill="Gray"/>
                <TextBlock x:Name="TabTitle" Text="New Tab" Margin="0,0,5,0" Foreground="{DynamicResource TabForeground}"/>
            </StackPanel>
            <Button x:Name="CloseButton" Content="Ã—" Width="20" Height="20" Grid.Column="1"
                    Padding="0" FontSize="14" FontWeight="Bold"
                    Click="CloseButton_Click" Cursor="Hand"
                    Background="Transparent" BorderThickness="0"
                    Foreground="{DynamicResource TabForeground}" MouseEnter="CloseButton_MouseEnter" 
                    MouseLeave="CloseButton_MouseLeave"
                    Margin="0,0,2,0"/>
        </Grid>
    </TabItem.Header>
    <TabItem.ContextMenu>
        <ContextMenu>
            <MenuItem Header="Edit Settings..." x:Name="EditSettingsMenuItem" Click="EditSettingsMenuItem_Click"/>
            <MenuItem Header="Raw mode" x:Name="ShowRawBufferMenuItem" IsCheckable="True" IsChecked="False" Click="ShowRawBufferMenuItem_Click"/>
            <Separator/>
            <MenuItem Header="Reconnect" x:Name="ReconnectMenuItem" Click="ReconnectMenuItem_Click"/>
            <Separator/>
            <MenuItem Header="Close Tab" Click="CloseButton_Click"/>
        </ContextMenu>
    </TabItem.ContextMenu>
    <Grid>
        <views:TerminalEmulator x:Name="TerminalControl"/>
    </Grid>
</TabItem>

