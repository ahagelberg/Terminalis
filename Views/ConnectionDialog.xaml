<Window x:Class="TabbySSH.Views.ConnectionDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        xmlns:views="clr-namespace:TabbySSH.Views"
        mc:Ignorable="d"
        Title="Session Configuration" Height="600" Width="820"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        Background="{DynamicResource WindowBackground}">
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0" ResizeBorderThickness="4" GlassFrameThickness="0"/>
    </WindowChrome.WindowChrome>
    <Window.Resources>
        <views:BoolToIntConverter x:Key="BoolToIntConverter"/>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>
    <Border BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Background="{DynamicResource WindowBackground}">
        <Grid Background="{DynamicResource WindowBackground}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="0"
                    Background="{DynamicResource TitleBarBackground}"
                    PreviewMouseLeftButtonDown="TitleBar_PreviewMouseLeftButtonDown"
                    Height="32">
                <Grid VerticalAlignment="Center">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Session Configuration" FontSize="14" FontWeight="Bold" Margin="15,0,0,0" Foreground="{DynamicResource TitleBarForeground}" VerticalAlignment="Center"/>
                    <Button Grid.Column="1" x:Name="CloseButton" Content="r" Width="46" Height="32"
                            Click="CloseButton_Click"
                            Background="Transparent" BorderThickness="0"
                            Foreground="{DynamicResource TitleBarForeground}"
                            FontFamily="Marlett" FontSize="12"
                            Cursor="Hand"
                            MouseEnter="CloseButton_MouseEnter" MouseLeave="CloseButton_MouseLeave"/>
                </Grid>
            </Border>

            <Grid Grid.Row="1" Margin="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Background="{DynamicResource PanelBackground}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="0,0,1,0">
                    <ListBox x:Name="NavListBox" Background="Transparent" BorderThickness="0"
                             ItemContainerStyle="{StaticResource SettingsNavItemStyle}"
                             SelectionChanged="NavListBox_SelectionChanged"
                             SelectedIndex="0">
                        <ListBoxItem x:Name="NavConnectionItem" Content="Connection"/>
                        <ListBoxItem x:Name="NavAuthenticationItem" Content="Authentication"/>
                        <ListBoxItem x:Name="NavTerminalAppearanceItem" Content="Terminal Appearance"/>
                        <ListBoxItem x:Name="NavTerminalBehaviourItem" Content="Terminal Behaviour"/>
                        <ListBoxItem x:Name="NavCompatibilityItem" Content="Compatibility"/>
                        <ListBoxItem x:Name="NavConnectionOptionsItem" Content="Connection Options"/>
                        <ListBoxItem x:Name="NavForwardingItem" Content="Forwarding"/>
                    </ListBox>
                </Border>

                <GridSplitter Grid.Column="1" Width="4" HorizontalAlignment="Stretch" Background="Transparent"/>

                <ScrollViewer x:Name="ContentScrollViewer" Grid.Column="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="24,20" ScrollChanged="ContentScrollViewer_ScrollChanged" SizeChanged="ContentScrollViewer_SizeChanged">
                    <StackPanel>
                        <!-- Connection -->
                        <Border x:Name="SectionConnection" Margin="0,0,0,24">
                            <StackPanel>
                                <TextBlock Text="Connection" FontSize="18" FontWeight="Bold" Foreground="{DynamicResource WindowForeground}" Margin="0,0,0,16"/>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Name:" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <TextBox Grid.Column="1" x:Name="NameTextBox" Margin="10,0,0,0"/>
                                </Grid>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Host:" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <TextBox Grid.Column="1" x:Name="HostTextBox" Margin="10,0,0,0"/>
                                </Grid>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Port:" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <Grid Grid.Column="1" Margin="10,0,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox Grid.Column="0" x:Name="PortTextBox" Text="22" VerticalContentAlignment="Center" Padding="5,0" Width="50" TextAlignment="Right"/>
                                        <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Stretch">
                                            <RepeatButton x:Name="PortUpButton" Content="▲" Width="20" Height="12" FontSize="8" Padding="0" Click="PortUpButton_Click" VerticalAlignment="Top"/>
                                            <RepeatButton x:Name="PortDownButton" Content="▼" Width="20" Height="12" FontSize="8" Padding="0" Click="PortDownButton_Click" VerticalAlignment="Bottom"/>
                                        </StackPanel>
                                    </Grid>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Authentication -->
                        <Border x:Name="SectionAuthentication" Margin="0,0,0,24">
                            <StackPanel>
                                <TextBlock Text="Authentication" FontSize="18" FontWeight="Bold" Foreground="{DynamicResource WindowForeground}" Margin="0,0,0,16"/>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Username:" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <TextBox Grid.Column="1" x:Name="UsernameTextBox" Margin="10,0,0,0"/>
                                </Grid>
                                <Grid Margin="0,12,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <RadioButton x:Name="PasswordAuthRadio" Content="Password" IsChecked="True" Grid.Column="0" VerticalAlignment="Center" GroupName="AuthMethod" Checked="PasswordAuthRadio_Checked"/>
                                    <PasswordBox Grid.Column="1" x:Name="PasswordBox" Margin="10,0,0,0" VerticalAlignment="Center"/>
                                </Grid>
                                <RadioButton x:Name="KeyAuthRadio" Content="Private Key" Margin="0,8" GroupName="AuthMethod" Checked="KeyAuthRadio_Checked"/>
                                <Grid Margin="20,8,0,8" IsEnabled="{Binding IsChecked, ElementName=KeyAuthRadio}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Key File:" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <TextBox Grid.Column="1" x:Name="PrivateKeyPathTextBox" Margin="10,0,10,0" IsReadOnly="True"/>
                                    <Button Grid.Column="2" Content="Browse..." x:Name="BrowseKeyButton" Padding="10,5" Click="BrowseKeyButton_Click"/>
                                </Grid>
                                <Grid Margin="20,8,0,8" IsEnabled="{Binding IsChecked, ElementName=KeyAuthRadio}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Passphrase:" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <PasswordBox Grid.Column="1" x:Name="PrivateKeyPassphraseBox" Margin="10,0,0,0"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Terminal Appearance -->
                        <Border x:Name="SectionTerminalAppearance" Margin="0,0,0,24">
                            <StackPanel>
                                <TextBlock Text="Terminal Appearance" FontSize="18" FontWeight="Bold" Foreground="{DynamicResource WindowForeground}" Margin="0,0,0,16"/>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Font Family:" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <ComboBox Grid.Column="1" x:Name="FontFamilyComboBox" Margin="10,0,0,0" IsEditable="False"/>
                                </Grid>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Font Size:" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <Grid Grid.Column="1" Margin="10,0,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox Grid.Column="0" x:Name="FontSizeTextBox" Text="12" VerticalContentAlignment="Center" Padding="5,0" Width="50" TextAlignment="Right"/>
                                        <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Stretch">
                                            <RepeatButton x:Name="FontSizeUpButton" Content="▲" Width="20" Height="12" FontSize="8" Padding="0" Click="FontSizeUpButton_Click" VerticalAlignment="Top"/>
                                            <RepeatButton x:Name="FontSizeDownButton" Content="▼" Width="20" Height="12" FontSize="8" Padding="0" Click="FontSizeDownButton_Click" VerticalAlignment="Bottom"/>
                                        </StackPanel>
                                    </Grid>
                                </Grid>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Foreground Color:" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="10,0,0,0" VerticalAlignment="Center">
                                        <Border x:Name="ForegroundColorBox" Width="50" Height="25" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Background="LightGray" Cursor="Hand" MouseLeftButtonDown="ForegroundColorBox_MouseLeftButtonDown" VerticalAlignment="Center"/>
                                        <Button Content="(Default)" Margin="10,0,0,0" Padding="5,2" Click="ForegroundColorDefaultButton_Click" VerticalAlignment="Center" Background="{DynamicResource ButtonBackground}" Foreground="{DynamicResource ButtonForeground}" BorderBrush="{DynamicResource ButtonBorder}"/>
                                    </StackPanel>
                                </Grid>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Background Color:" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="10,0,0,0" VerticalAlignment="Center">
                                        <Border x:Name="BackgroundColorBox" Width="50" Height="25" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Background="Black" Cursor="Hand" MouseLeftButtonDown="BackgroundColorBox_MouseLeftButtonDown" VerticalAlignment="Center"/>
                                        <Button Content="(Default)" Margin="10,0,0,0" Padding="5,2" Click="BackgroundColorDefaultButton_Click" VerticalAlignment="Center" Background="{DynamicResource ButtonBackground}" Foreground="{DynamicResource ButtonForeground}" BorderBrush="{DynamicResource ButtonBorder}"/>
                                    </StackPanel>
                                </Grid>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Accent Color:" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="10,0,0,0" VerticalAlignment="Center">
                                        <Border x:Name="AccentColorBox" Width="50" Height="25" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Background="Transparent" Cursor="Hand" MouseLeftButtonDown="AccentColorBox_MouseLeftButtonDown" VerticalAlignment="Center"/>
                                        <Button Content="(Default)" Margin="10,0,0,0" Padding="5,2" Click="AccentColorDefaultButton_Click" VerticalAlignment="Center" Background="{DynamicResource ButtonBackground}" Foreground="{DynamicResource ButtonForeground}" BorderBrush="{DynamicResource ButtonBorder}"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Terminal Behaviour -->
                        <Border x:Name="SectionTerminalBehaviour" Margin="0,0,0,24">
                            <StackPanel>
                                <TextBlock Text="Terminal Behaviour" FontSize="18" FontWeight="Bold" Foreground="{DynamicResource WindowForeground}" Margin="0,0,0,16"/>
                                <CheckBox x:Name="ResetScrollOnUserInputCheckBox" Content="Reset Scroll Position on User Input" Margin="0,8" IsChecked="True"/>
                                <CheckBox x:Name="ResetScrollOnServerOutputCheckBox" Content="Reset Scroll Position on Server Output" Margin="0,8" IsChecked="False"/>
                                <CheckBox x:Name="AllowTitleChangeCheckBox" Content="Allow Server to Change Window Title" Margin="0,8" IsChecked="False"/>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Bell Notification:" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <ComboBox Grid.Column="1" x:Name="BellNotificationComboBox" Margin="10,0,0,0" SelectedIndex="1">
                                        <ComboBoxItem Content="Flash"/>
                                        <ComboBoxItem Content="Line Flash"/>
                                        <ComboBoxItem Content="Sound"/>
                                        <ComboBoxItem Content="None"/>
                                    </ComboBox>
                                </Grid>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Auto Reconnect:" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <ComboBox Grid.Column="1" x:Name="AutoReconnectComboBox" Margin="10,0,0,0" SelectedIndex="2">
                                        <ComboBoxItem Content="None"/>
                                        <ComboBoxItem Content="On Disconnect"/>
                                        <ComboBoxItem Content="On Focus/Switch"/>
                                    </ComboBox>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Compatibility -->
                        <Border x:Name="SectionCompatibility" Margin="0,0,0,24">
                            <StackPanel>
                                <TextBlock Text="Compatibility" FontSize="18" FontWeight="Bold" Foreground="{DynamicResource WindowForeground}" Margin="0,0,0,16"/>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Backspace Key:" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <ComboBox Grid.Column="1" x:Name="BackspaceKeyComboBox" Margin="10,0,0,0" SelectedIndex="0">
                                        <ComboBoxItem Content="DEL (0x7F)" Tag="DEL"/>
                                        <ComboBoxItem Content="Ctrl+H (0x08)" Tag="CtrlH"/>
                                    </ComboBox>
                                </Grid>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Resize Method:" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <ComboBox Grid.Column="1" x:Name="TerminalResizeMethodComboBox" Margin="10,0,0,0" SelectedIndex="0">
                                        <ComboBoxItem Content="SSH (Recommended)" Tag="SSH"/>
                                        <ComboBoxItem Content="ANSI" Tag="ANSI"/>
                                        <ComboBoxItem Content="STTY" Tag="STTY"/>
                                        <ComboBoxItem Content="XTERM" Tag="XTERM"/>
                                        <ComboBoxItem Content="None" Tag="NONE"/>
                                    </ComboBox>
                                </Grid>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Line Ending:" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <ComboBox Grid.Column="1" x:Name="LineEndingComboBox" Margin="10,0,0,0" SelectedIndex="0">
                                        <ComboBoxItem Content="Unix (LF)" Tag="\n"/>
                                        <ComboBoxItem Content="Windows (CRLF)" Tag="\r\n"/>
                                    </ComboBox>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Connection Options -->
                        <Border x:Name="SectionConnectionOptions" Margin="0,0,0,24">
                            <StackPanel>
                                <TextBlock Text="Connection Options" FontSize="18" FontWeight="Bold" Foreground="{DynamicResource WindowForeground}" Margin="0,0,0,16"/>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Keep-Alive (sec):" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <Grid Grid.Column="1" Margin="10,0,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox Grid.Column="0" x:Name="KeepAliveTextBox" Text="30" VerticalContentAlignment="Center" Padding="5,0" Width="50" TextAlignment="Right"/>
                                        <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Stretch">
                                            <RepeatButton x:Name="KeepAliveUpButton" Content="▲" Width="20" Height="12" FontSize="8" Padding="0" Click="KeepAliveUpButton_Click" VerticalAlignment="Top"/>
                                            <RepeatButton x:Name="KeepAliveDownButton" Content="▼" Width="20" Height="12" FontSize="8" Padding="0" Click="KeepAliveDownButton_Click" VerticalAlignment="Bottom"/>
                                        </StackPanel>
                                    </Grid>
                                </Grid>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Timeout (sec):" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <Grid Grid.Column="1" Margin="10,0,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox Grid.Column="0" x:Name="TimeoutTextBox" Text="30" VerticalContentAlignment="Center" Padding="5,0" Width="50" TextAlignment="Right"/>
                                        <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Stretch">
                                            <RepeatButton x:Name="TimeoutUpButton" Content="▲" Width="20" Height="12" FontSize="8" Padding="0" Click="TimeoutUpButton_Click" VerticalAlignment="Top"/>
                                            <RepeatButton x:Name="TimeoutDownButton" Content="▼" Width="20" Height="12" FontSize="8" Padding="0" Click="TimeoutDownButton_Click" VerticalAlignment="Bottom"/>
                                        </StackPanel>
                                    </Grid>
                                </Grid>
                                <CheckBox x:Name="CompressionCheckBox" Content="Enable Compression" Margin="0,8" IsChecked="True"/>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Gateway Session:" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <ComboBox Grid.Column="1" x:Name="GatewaySessionComboBox" Margin="10,0,0,0" DisplayMemberPath="Name" SelectedValuePath="Id"/>
                                </Grid>
                                <TextBlock Text="(Optional: Select an existing session to use as SSH gateway/jump host)" FontSize="10" FontStyle="Italic" Foreground="Gray" Margin="0,0,0,8"/>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Screen Session:" VerticalAlignment="Center" Foreground="{DynamicResource WindowForeground}"/>
                                    <TextBox Grid.Column="1" x:Name="ScreenSessionNameTextBox" Margin="10,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>
                                <TextBlock Text="(Leave empty to connect normally. Enter a name to connect to/create a persistent screen session)" FontSize="10" FontStyle="Italic" Foreground="Gray" Margin="0,0,0,8"/>
                            </StackPanel>
                        </Border>

                        <!-- Forwarding -->
                        <Border x:Name="SectionForwarding" Margin="0,0,0,24">
                            <StackPanel>
                                <TextBlock Text="Forwarding" FontSize="18" FontWeight="Bold" Foreground="{DynamicResource WindowForeground}" Margin="0,0,0,16"/>
                                <CheckBox x:Name="X11ForwardingCheckBox" Content="Enable X11 Forwarding" Margin="0,8" IsChecked="False"/>
                                <TextBlock Text="Port Forwarding" FontWeight="Bold" Margin="0,16,0,8" Foreground="{DynamicResource WindowForeground}"/>
                                <DataGrid x:Name="PortForwardingDataGrid" AutoGenerateColumns="False" CanUserAddRows="True" CanUserDeleteRows="True" Height="150" Margin="0,8">
                                    <DataGrid.Columns>
                                        <DataGridCheckBoxColumn Header="Enabled" Binding="{Binding Enabled}" Width="60" ElementStyle="{StaticResource DataGridCheckBoxStyle}" EditingElementStyle="{StaticResource DataGridCheckBoxStyle}"/>
                                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="120"/>
                                        <DataGridTemplateColumn Header="Type" Width="80">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding TypeDisplay}"/>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                            <DataGridTemplateColumn.CellEditingTemplate>
                                                <DataTemplate>
                                                    <ComboBox SelectedIndex="{Binding IsLocal, Converter={StaticResource BoolToIntConverter}}" SelectionChanged="TypeComboBox_SelectionChanged" Loaded="TypeComboBox_Loaded">
                                                        <ComboBoxItem Content="Local"/>
                                                        <ComboBoxItem Content="Remote"/>
                                                    </ComboBox>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellEditingTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTextColumn Header="Local Host" Binding="{Binding LocalHost}" Width="90"/>
                                        <DataGridTextColumn Header="Local Port" Binding="{Binding LocalPort}" Width="75"/>
                                        <DataGridTextColumn Header="Remote Host" Binding="{Binding RemoteHost}" Width="90"/>
                                        <DataGridTextColumn Header="Remote Port" Binding="{Binding RemotePort}" Width="75"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                    <Button Content="Add Local Forward" x:Name="AddLocalForwardButton" Padding="10,5" Margin="0,0,5,0" Click="AddLocalForwardButton_Click"/>
                                    <Button Content="Add Remote Forward" x:Name="AddRemoteForwardButton" Padding="10,5" Click="AddRemoteForwardButton_Click"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                        <!-- Extra space so last section can scroll to top and be selected (height set in code to viewport height) -->
                        <Border x:Name="BottomSpacer" Height="0"/>
                    </StackPanel>
                </ScrollViewer>
            </Grid>

            <Border Grid.Row="2" Background="{DynamicResource WindowBackground}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="0,1,0,0" Margin="15,10,15,15">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Button Grid.Column="1" Content="Save" x:Name="ConnectButton"
                            Click="ConnectButton_Click" Padding="20,8" Margin="0,0,10,0" IsDefault="True"
                            Background="{DynamicResource ButtonBackground}" Foreground="{DynamicResource ButtonForeground}"
                            BorderBrush="{DynamicResource ButtonBorder}"/>
                    <Button Grid.Column="2" Content="Cancel" x:Name="CancelButton"
                            Click="CancelButton_Click" Padding="20,8" IsCancel="True"
                            Background="{DynamicResource ButtonBackground}" Foreground="{DynamicResource ButtonForeground}"
                            BorderBrush="{DynamicResource ButtonBorder}"/>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
